<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>🌍 داشبورد - مکان‌های دقیق</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        body { margin: 0; padding: 0; font-family: Arial, sans-serif; }
        #map { height: 100vh; width: 100%; }
        .header {
            position: absolute;
            top: 15px;
            left: 15px;
            background: white;
            padding: 10px 15px;
            border-radius: 8px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
            z-index: 1000;
            font-weight: bold;
            color: #0078d7;
        }
    </style>
</head>
<body>
    <div class="header">📡 مکان‌های دقیق ارسال‌شده (GPS)</div>
    <div id="map"></div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        const map = L.map('map').setView([32.4279, 53.6880], 5); // مرکز ایران

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; OpenStreetMap'
        }).addTo(map);

        const markers = [];

        function update() {
            fetch('/data')
                .then(res => res.json())
                .then(points => {
                    markers.forEach(m => map.removeLayer(m));
                    markers.length = 0;

                    points.forEach((p, i) => {
                        const marker = L.marker([p.lat, p.lng])
                            .addTo(map)
                            .bindPopup(`نفر ${i + 1}<br>عرض: ${p.lat.toFixed(4)}<br>طول: ${p.lng.toFixed(4)}`);
                        markers.push(marker);
                    });

                    if (points.length > 0) {
                        const group = L.featureGroup(markers);
                        map.fitBounds(group.getBounds().pad(0.2));
                    }
                });
        }

        update();
        setInterval(update, 3000); // هر ۳ ثانیه بروزرسانی
    </script>
</body>
</html>
