<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>🌍 پنل کلاسی - نقشه زنده</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        body { margin: 0; padding: 0; font-family: Arial, sans-serif; }
        #map { height: 100vh; width: 100%; }
        .header {
            position: absolute;
            top: 10px;
            left: 10px;
            background: white;
            padding: 10px 15px;
            border-radius: 8px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
            z-index: 1000;
        }
    </style>
</head>
<body>
    <div class="header">📡 پروژه آموزشی - مکان‌های ارسال‌شده (به‌روزرسانی هر ۵ ثانیه)</div>
    <div id="map"></div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        const map = L.map('map').setView([35.6892, 51.3890], 6); // مرکز ایران

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; OpenStreetMap'
        }).addTo(map);

        const markers = [];

        function updateMap() {
            fetch('/data')
                .then(res => res.json())
                .then(points => {
                    // پاک کردن مارکرهای قبلی
                    markers.forEach(marker => map.removeLayer(marker));
                    markers.length = 0;

                    // اضافه کردن مارکرهای جدید
                    points.forEach((point, i) => {
                        const marker = L.marker([point.lat, point.lng])
                            .addTo(map)
                            .bindPopup(`نفر ${i + 1}<br>عرض: ${point.lat.toFixed(4)}<br>طول: ${point.lng.toFixed(4)}`);
                        markers.push(marker);
                    });

                    if (points.length > 0) {
                        const group = new L.featureGroup(markers);
                        map.fitBounds(group.getBounds().pad(0.2));
                    }
                });
        }

        updateMap();
        setInterval(updateMap, 5000); // هر ۵ ثانیه بروزرسانی
    </script>
</body>
</html>
